<div class="custum_container">
  <div class="row header-row">
      <div class="col-12 d-flex justify-content-between align-items-center">
          <div class="brand-section d-flex align-items-center">
              <img src="../../../assets/invoice 360.png" alt="Logo" class="brand-logo" />
              <div>
                  <div class="button-group">
                      <h4 class="brand-title">Invoice 360</h4>
                      <button class="time-section action-btn recent-btn">‚å®Ô∏è</button>
                      <small class="time-section action-btn report-btn">{{ currentDateTime }}</small>
                  </div>
              </div>
          </div>
          <div class="button-group">
              <button class="action-btn report-btn">Report</button>
              <button class="action-btn return-btn">Return</button>
              <button class="action-btn recent-btn">Recent</button>
              <button class="action-btn draft-btn">Draft (0)</button>
              <button class="action-btn exit-btn">Exit</button>
          </div>
      </div>
  </div>

  <div class="row">
      <div class="col-md-6">
          <input type="text" class="form-control serarch-Section" placeholder="üîç Search by Product Name, Generic, Barcode..." [(ngModel)]="searchText"(input)="searchProduct()" />

          <div class="row d-flex ">
              <div class="col-md-4">
                  <h6>All Medicine</h6>
              </div>
              <div class="col-md-4">
                  <h6>Total Products ( {{ filteredProducts.length }} )</h6>
              </div>
      

              <div class="col-md-4">
                  <div class="dropdown">
                      <button class="dropdown-toggle w-100"
                              type="button"
                              id="brandDropdown"
                              data-bs-toggle="dropdown"
                              aria-expanded="false">
                         Select Brand
                      </button>
                      <ul class="dropdown-menu w-100" aria-labelledby="brandDropdown">
                          <li *ngFor="let brand of brands"
                              class="dropdown-item d-flex justify-content-between align-items-center"
                              (click)="filterByBrand(brand.id)">
                              {{ brand.name }}
                          </li>
                      </ul>
                  </div>
              </div>

          </div>
        </div>
          <div class="col-md-6">
              <input type="text" class="form-control serarch-Section" placeholder="Search by  Barcode..." [(ngModel)]="searchText" (input)="searchProduct()" />

          </div>
     
        </div>
    


  <div class="row mt-2">
 
    <div class="col-md-1 category-section">
        <ul class="list-group category-list">
          <li *ngFor="let category of categories" class="list-group-item" (click)="filterByCategory(category.id)">
            {{ category.name }}
          </li>
        </ul>
      </div>

      <div class="col-md-4 product-section scrollable-container">
        <div class="row">
          <div *ngFor="let product of filteredProducts" class="col-md-4 mb-3">
            <div class="card" (click)="addToCart(product)" style="cursor: pointer;">
              <div class="d-flex btn-group">
                <div>
                  <img *ngIf="product.id" [src]="getProductImageUrl(product.id)" class="product-image" />
                </div>
                <div style="justify-content: end;">
                  <p class="stock-alart">
                    {{ product.stockQuantity > 0 ? 'In stock ' + product.stockQuantity : 'Out of stock' }}
                  </p>
                  <p
                    class="quantity"
                    [ngClass]="{
                      'text-danger': product.stockQuantity === 0,
                      'text-success': product.stockQuantity > 0
                    }"
                  ></p>
                  <p *ngIf="product.discount" class="stock-alart text-danger">
                    {{ product.discount }}% Off
                  </p>
                </div>
              </div>
              <div class="card-body">
                <h6 class="card-title">{{ product.name }}</h6>
                <p class="card-text">Tk: {{ product.price }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
  
      <div class="col-md-6">
          <h5>Cart</h5>
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>No</th>
                <th>Item</th>
                <th>Quantity</th>
                <th>Price</th>
                <th>Discount</th>
                <th>SubTotal</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of cartItems; let i = index">
                <td>{{ i + 1 }}</td> 
               <td class="items-name"> {{ item.productName }}</td>
                <td>
                  <div class="input-group">
                    <button (click)="decreaseQty(item)" class="btn btn-outline-secondary btn-sm">-</button>
                    <input type="text" class="form-control text-center" [value]="item.quantity" readonly />
                    <button (click)="increaseQty(item)" class="btn btn-outline-secondary btn-sm">+</button>
                  </div>
                </td>
                <td>{{ item.price | currency }}</td>
                <td>{{ item.discount | currency }}</td>
                <td>{{ (item.price * item.quantity - item.discount * item.quantity) | currency }}</td>
                <td>
                  <button (click)="removeFromCart(item.productId)" class="btn btn-danger btn-sm">
                    <i class="bi bi-trash text-danger"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
          <div>
            <p><strong>Subtotal:</strong> {{ subtotal | currency }}</p>
            <p><strong>VAT:</strong> {{ vat | currency }}</p>
            <p><strong>Discount:</strong> {{ discount | currency }}</p>
            <p><strong>Total:</strong> {{ total | currency }}</p>
            
          </div>
          <button class="btn btn-success w-100">Proceed to Payment</button>
      </div>

      <div class="footer-row d-flex justify-content-between align-items-center p-3">
        <div class="button-group">
          <button class="btn btn-warning " (click)="resetCart()">Reset Cart</button>
          <button class="action-btn">ADD INFO</button>
          <button class="action-btn" (click)="openAddProductModal()">ADD PRODUCT</button>
          <button class="action-btn"> {{ total | currency }}</button>
          <button class="action-btn">INFO</button>
          <button class="action-btn">Terms of Service</button>
        </div>
      </div>
    </div>
  </div>

  

  <div
  *ngIf="showModal"
  class="modal fade show"
  style="display: block; background: rgba(0, 0, 0, 0.5);"
  id="addProductModal"
  tabindex="-1"
  aria-labelledby="addProductModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content custom-modal">
      <div class="modal-header">
        <h5 class="modal-title" id="addProductModalLabel">Add New Product</h5>
        <button
          type="button"
          class="btn-close"
          (click)="closeAddProductModal()"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <form #addProductForm="ngForm" (ngSubmit)="addProduct(addProductForm)">
          <div class="form-grid">
            <div class="form-group">
              <label for="name" class="form-label">Product Name</label>
              <input
                type="text"
                id="name"
                class="form-control"
                name="name"
                [(ngModel)]="newProduct.name"
                required
              />
            </div>
            <div class="form-group">
              <label for="category" class="form-label">Category</label>
              <select
                id="category"
                class="form-select"
                name="categoryId"
                [(ngModel)]="newProduct.categoryId"
                required
              >
                <option
                  *ngFor="let category of categories"
                  [value]="category.id"
                >
                  {{ category.name }}
                </option>
              </select>
            </div>
            <div class="form-group">
              <label for="price" class="form-label">Price</label>
              <input
                type="number"
                id="price"
                class="form-control"
                name="price"
                [(ngModel)]="newProduct.price"
                required
              />
            </div>
            <div class="form-group">
              <label for="stockQuantity" class="form-label">Stock Quantity</label>
              <input
                type="number"
                id="stockQuantity"
                class="form-control"
                name="stockQuantity"
                [(ngModel)]="newProduct.stockQuantity"
                required
              />
            </div>
            <div class="form-group">
              <label for="barcode" class="form-label">Barcode</label>
              <input
                type="text"
                id="barcode"
                class="form-control"
                name="barcode"
                [(ngModel)]="newProduct.barcode"
              />
            </div>
            <div class="form-group">
              <label for="generic" class="form-label">Generic</label>
              <input
                type="text"
                id="generic"
                class="form-control"
                name="generic"
                [(ngModel)]="newProduct.generic"
                required
              />
            </div>
            <div class="form-group">
              <label for="image" class="form-label">Product Image</label>
              <input
                type="file"
                id="image"
                class="form-control"
                (change)="onFileSelected($event)"
              />
            </div>
            <div class="form-group">
              <label for="discount" class="form-label">Discount</label>
              <input
                type="number"
                id="discount"
                class="form-control"
                name="discount"
                [(ngModel)]="newProduct.discount"
                min="0"
                required
              />
            </div>
            <div class="form-group">
              <label for="vat" class="form-label">VAT</label>
              <input
                type="number"
                id="vat"
                class="form-control"
                name="vat"
                [(ngModel)]="newProduct.vat"
                min="0"
                required
              />
            </div>
          </div>
          <div class="text-center mt-3">
            <button
              type="submit"
              class="btn btn-primary w-100"
              [disabled]="addProductForm.invalid"
            >
              Save Product
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
